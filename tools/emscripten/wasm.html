<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
    <style>
      .emscripten { 
          padding-right: 0; 
          margin-left: auto; 
          margin-right: auto; 
          display: block; 
          background-color: #181818;
          border-color: #99cc66;
          font-family: monospace; 
          color: white; 
          width: 80%; 
      }
      textarea.emscripten { 
          font-family: monospace; 
          width: 80%; 
      }
      body {
        background-color: #101010; 
      }

      .greentext {
          color: #99cc66;
      }

      h1{
          color: #99cc66;
          text-align: center;

      }
      .collapsible {
        background-color: #181818;
        color: #99cc66;
        border-color: #99cc66;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
      }
      .active, .collapsible:hover {
          text-decoration: underline;
            color: #181818;
            border-color: #181818;
            background-color: #99cc66;
      }

      .content {
        padding: 0 18px;
        display: none;
        overflow: hidden;
        background-color: #181818;
      }
      .node circle {
              fill: #000;
              stroke: #99cc66;
              stroke-width: 3px;
        }

        .node text { font: 12px sans-serif; 
              fill: #99cc66;
              }

            .link {
                      fill: none;
                          stroke: #99cc66;
                              stroke-width: 2px;
                }

    </style>
  </head>
  <body>
    <h1 class="title" >THE BINDER v0.0.1</h1>
    <label for="source" class="greentext">Write your source code here and press enter to evaluate</label>
    <textarea class="emscripten" id="source" rows="16" ></textarea>
    <label  for="output" class="greentext">code output:</label>
    <textarea class="emscripten" id="output" rows="8"></textarea>
    <button type="button" class="collapsible">AST</button>
    <div class="content" id="AST">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>




    <script src="sigma.min.js"></script>
    <script src="sigma.parsers.json.min.js"></script>
    <script type='text/javascript'>
      document.getElementById("source").addEventListener("keypress",(event)=>{
        if(event.key === "Enter")
        {
            processCode();
        }
      });

    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
                  this.classList.toggle("active");
                  var content = this.nextElementSibling;
                  if (content.style.display === "block") {
                            content.style.display = "none";
                          } else {
                                    content.style.display = "block";
                                  }
                });
    }

    function processCode()
    {
        
        
          var element = document.getElementById('source');

          //var source = "(){}}{(,.-+*";
          var source = element.value;
          var ptr  = allocate(intArrayFromString(source), 'i8', ALLOC_NORMAL);
          Module.binderExecuteWASM(source);
        _free(ptr);

    }



      var Module = {
        preRun: [],
          postRun: [()=>{
          
          console.log("loaded");
          Module.binderExecuteWASM = this.cwrap('bindExecute','',['string']);
          console.log(Module);
          }], 
         print: 
          (text)=>{
            console.log(text);
          var element = document.getElementById('output');
              if (element) {
              element.value += text + "\n";
              element.scrollTop = element.scrollHeight; // focus on bottom
              }
          },
        printErr: function(text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          console.error(text);
        },
      };
      window.onerror = function() {
        //Module.setStatus('Exception thrown, see JavaScript console');
        //Module.setStatus = function(text) {
        //  if (text) Module.printErr('[post-exception status] ' + text);
        //};
      };

    </script>
    {{{ SCRIPT }}}
  </body>
</html>
