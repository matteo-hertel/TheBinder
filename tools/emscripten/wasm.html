<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
    <style>
      .emscripten { 
          padding-right: 0; 
          margin-left: auto; 
          margin-right: auto; 
          display: block; 
          background-color: #181818;
          border-color: #99cc66;
          font-family: monospace; 
          color: white; 
          width: 80%; 
      }
      textarea.emscripten { 
          font-family: monospace; 
          width: 80%; 
      }
      body {
        background-color: #101010; 
      }

      .greentext {
          color: #99cc66;
      }

      h1{
          color: #99cc66;
          text-align: center;

      }
      .collapsible {
        background-color: #181818;
        color: #99cc66;
        border-color: #99cc66;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
      }
      .active, .collapsible:hover {
          text-decoration: underline;
            color: #181818;
            border-color: #181818;
            background-color: #99cc66;
      }

      .content {
        padding: 0 18px;
        display: none;
        overflow: hidden;
        background-color: #181818;
      }
      .node circle {
              fill: #000;
              stroke: #99cc66;
              stroke-width: 3px;
        }

        .node text { font: 12px sans-serif; 
              fill: #99cc66;
              }

            .link {
                      fill: none;
                          stroke: #99cc66;
                              stroke-width: 2px;
                }

    </style>
  </head>
  <body>
    <h1 class="title" >THE BINDER v0.0.1</h1>
    <label for="source" class="greentext">Write your source code here and press enter to evaluate</label>
    <textarea class="emscripten" id="source" rows="16" ></textarea>
    <label  for="output" class="greentext">code output:</label>
    <textarea class="emscripten" id="output" rows="8"></textarea>
    <button type="button" class="collapsible">AST</button>
    <div class="content" id="AST">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script type='text/javascript'>
      document.getElementById("source").addEventListener("keypress",(event)=>{
        if(event.key === "Enter")
        {
          console.log("submit code");
        }
      });

    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
                  this.classList.toggle("active");
                  var content = this.nextElementSibling;
                  if (content.style.display === "block") {
                            content.style.display = "none";
                          } else {
                                    content.style.display = "block";
                                  }
                });
    }

function tree(){
    var treeData = [
    {
    "name": "Top Level",
    "parent": "null",
    "children": [
        {
        "name": "Level 2: A",
        "parent": "Top Level",
        "children": [
                {
                "name": "Son of A",
                "parent": "Level 2: A"
                },
                {
                "name": "Daughter of A",
                "parent": "Level 2: A"
                }
            ]
        },
        {
        "name": "Level 2: B",
        "parent": "Top Level"
        }
    ]
    }
    ];
var margin = {top: 40, right: 120, bottom: 20, left: 120},
        width = 960 - margin.right - margin.left,
        height = 500 - margin.top - margin.bottom;
    
var i = 0;

var tree = d3.layout.tree()
    .size([height, width]);

var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [d.x, d.y]; });

var svg = d3.select("div#AST").append("svg")
    .attr("width", width + margin.right + margin.left)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

root = treeData[0];
  
update(root);

function update(source) {

      // Compute the new tree layout.
      var nodes = tree.nodes(root).reverse(),
              links = tree.links(nodes);

      // Normalize for fixed-depth.
      nodes.forEach(function(d) { d.y = d.depth * 100; });

      // Declare the nodes…
      var node = svg.selectAll("g.node")
          .data(nodes, function(d) { return d.id || (d.id = ++i); });

      // Enter the nodes.
      var nodeEnter = node.enter().append("g")
          .attr("class", "node")
          .attr("transform", function(d) { 
                      return "translate(" + d.x + "," + d.y + ")"; });

      nodeEnter.append("circle")
          .attr("r", 10)
          .style("fill", "#252525");

      nodeEnter.append("text")
          .attr("y", function(d) { 
                      return d.children || d._children ? -18 : 18; })
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .text(function(d) { return d.name; })
          .style("fill-opacity", 1);

      // Declare the links…
      var link = svg.selectAll("path.link")
          .data(links, function(d) { return d.target.id; });

      // Enter the links.
          link.enter().insert("path", "g")
          .attr("class", "link")
          .attr("d", diagonal);

}
}


      var Module = {
        preRun: [],
          postRun: [()=>{
          
          console.log("loaded");
          var  testX = this.cwrap('testMe','number',['number']);
          console.log(testX(12));
          //Module.test(12);
          console.log(Module);
          tree();
          }], 
         print: 
          //(function() {
          //var element = document.getElementById('output');
          //if (element) element.value = ''; // clear browser cache
          //return function(text) {
          //  if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          //  // These replacements are necessary if you render to raw HTML
          //  //text = text.replace(/&/g, "&amp;");
          //  //text = text.replace(/</g, "&lt;");
          //  //text = text.replace(/>/g, "&gt;");
          //  //text = text.replace('\n', '<br>', 'g');
          //  console.log(text);
          //  if (element) {
          //    element.value += text + "\n";
          //    element.scrollTop = element.scrollHeight; // focus on bottom
          //  }
          //};
            //})(),
          (text)=>console.log(text),
        printErr: function(text) {
          if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
          console.error(text);
        },
      };
      window.onerror = function() {
        //Module.setStatus('Exception thrown, see JavaScript console');
        //Module.setStatus = function(text) {
        //  if (text) Module.printErr('[post-exception status] ' + text);
        //};
      };

    </script>
    {{{ SCRIPT }}}
  </body>
</html>
